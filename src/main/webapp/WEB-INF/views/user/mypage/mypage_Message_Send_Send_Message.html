<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>mypage_message_send_send_massage</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
		integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
		integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
		integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
		crossorigin="anonymous"></script>

</head>

<body>
	<!-- 보낸 쪽지함 상세보기 -->
	<div th:replace="/user/includes/header :: header"></div>
	<!--  윗부분 시작 //////////////////////////////////////// -->

	<div class="container"
		style="margin-top: 25px; margin-bottom: 25px; padding: 0px; background-color: white; height: 500px; width: 900px;">
		<a href="/mypage/mypage_Message_From_Board.do">
			<button type="button" class="btn btn-secondary"
				style="height:110px; position: relative; left: -68px; border-radius: 15px 0px 0px 15px; background-color: #18d26e; ">
				<b><span>받은<br>
						쪽지함</span></b>
			</button>
		</a> <a href="/mypage/mypage_Message_Send_Board.do">
			<button type="button" class="btn btn-secondary" style="height:110px;position: relative; left:-144px; bottom: -110px;border-radius: 15px 0px 0px 15px;
		background-color: #18d26e;"> <b><span>보낸<br> 쪽지함</span></b>
			</button>
		</a> <br />
		<div class="row" style="position: relative; top:-90px;">
			<div class="col-md-11" style="padding: 30px 30px 0px 30px; margin-left: 30px;">
				<img src="../../../../resources/images/img/message_black.png" alt="" style="height: 45px;"> &nbsp;
				<span style="font-size: x-large;"> <b>쪽지 보내기</b> </span>
				<hr style="border:solid 0.5px; margin-top:0px;">
			</div>
			<div></div>
			<div class="col-md-1">
			</div>
		</div>

		<form action="sendMessage.do">
			<div class="row form-group" style="margin: 0px 20px 10px 20px; position: relative; top: -90px;">
				<div class="col-md-2" style="place-self: flex-end; text-align: center;">
					<label for="sel1">받는사람</label>
				</div>
				<th:block th:if="${senderid != null}">
					<input type="text" name="m_to" id="m_to" th:value="${senderid}" readonly />
				</th:block>
				<th:block th:if="${senderid == null}">
					<div class="col-md-10" style="align-self: center;">
						<input type="form-g" name="m_to" id="m_to" />
					</div>
				</th:block>
				<button type="submit" id="sendBtn" class="btn btn-secondary" style="background-color: #18d26e; padding:5px;">보내기</button>
			</div>

			<div class="row" style="margin: 20px 30px 0px 30px; position: relative; top: -90px;">
				<textarea class="form-control" id="msg" cols="30" rows="10" style="width: 100%"
					placeholder="내용을 입력해주세요"></textarea>
			</div>
		</form>
	</div>
	<!--  윗부분 끝 //////////////////////////////////////// -->

	<div th:replace="/user/includes/footer :: footer"></div>


	<script type="text/javascript">
		$(document).ready(function () {
			connect();
			$('#sendBtn').click(function () {
				console.log("하이욤")
				send();
				//form태그 이동..
			});
		})

		var wsocket;

		function connect() {
			wsocket = new WebSocket("ws://192.168.0.2:8001/messageSocket.do");
			wsocket.onopen = onOpen;
			wsocket.onmessage = onMessage;
			wsocket.onclose = onClose;
		}
		function disconnect() {
			wsocket.close();
		}

		function onOpen(evt) {
			console.log("onOpen(evt)");
		}

		function onMessage(evt) {
			/* console.log("evt :" + evt);
			var data = evt.data;
			appendMessage(data); */
		}

		function onClose(evt) {
		}

		function send() {
			let m_to = $('#m_to').val();

			let msg = $('#msg').val();

			wsocket.send(m_to + "," + msg);
			$('#m_to').val("");
			$('#msg').val("");
		}

		//자기 자신한테 보냈을때 실행
		function appendMessage(msg) {
			console.log(msg);
			alert("msg : " + msg);
		}

	</script>

</body>


</html>