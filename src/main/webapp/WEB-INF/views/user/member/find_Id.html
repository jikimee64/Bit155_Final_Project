<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>find_id</title>

<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
	integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
	crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
	integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
	integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
	crossorigin="anonymous"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
	integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
	crossorigin="anonymous"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<style>
</style>



<body>
	<div th:replace="/user/includes/header :: header"></div>
	<br />
	<div id="app">
		<div class="container" style="width: 27%;">
			<h3 style="text-align: center;">
				<b>아이디 찾기</b>
			</h3>
			<hr />
			<br />
			<form action="" class="needs-validation" novalidate>
				<div class="form-group">
					<label for="username">이름</label>
					<div class="row" style="place-content: center;">
						<input type="text" v-model="username" class="form-control"
							id="username" placeholder="Enter username" name="username"
							style="width: 95%;" required>
					</div>
				</div>

				<div class="form-group">
					<label for="userid">이메일주소</label>
					<div class="row" style="place-content: center;">
						<input type="text" v-model="useremail" class="form-control"
							id="userid" placeholder="Enter userid" name="uname"
							style="width: 70%;" required> &nbsp;
						<button v-on:click="emailCheck" type="submit"
							class="btn btn-warning" style="width: 25%; font-size: small;">인증받기</button>
						<div id="alert">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
					</div>
				</div>

				<div class="form-group">
					<label for="userid"></label>
					<div class="row" style="place-content: center;">
						<input type="text" class="form-control" id="AuthInput"
							placeholder="인증 번호 입력" name="uname" style="width: 70%;" required>
						&nbsp;
						<button type="button" class="btn btn-success"
							style="width: 25%; font-size: small;" id="Authbtn">확인</button>
							<div id="alert2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
					</div>
				</div>
				<br />

				<div style="text-align: end;">
					<button type="button" class="btn btn-warning"
						style="width: 40%; height: 55px;">로그인 하러가기</button>
				</div>
			</form>

			<p></p>
					<input type="hidden" value="" id="aa">
					<input type="hidden" value="" id="bb">

			<br /> <br />

		</div>
	</div>
	<div th:replace="/user/includes/footer :: footer"></div>
	<script>
		// Disable form submissions if there are invalid fields
		(function () {
			'use strict';
			window.addEventListener('load', function () {
				// Get the forms we want to add validation styles to
				var forms = document.getElementsByClassName('needs-validation');
				// Loop over them and prevent submission
				var validation = Array.prototype.filter.call(forms, function (form) {
					form.addEventListener('submit', function (event) {
						if (form.checkValidity() === false) {
							event.preventDefault();
							event.stopPropagation();
						}
						form.classList.add('was-validated');
					}, false);
				});
			}, false);
		})();
	</script>

	<script>
        new Vue({
            el: '#app',
            data: {
            	username: '',
            	useremail: ''
            },
            methods: {
            	emailCheck(){
            		if(this.username !== '' && this.useremail !== ''){ //username이랑 userid가 빈값이 아닐 때
            			axios.post('/ajax/emailCheck.do', 
            				{username: this.username, 
            				useremail: this.useremail})
            			.then(res => { 
            				//데이터를 받아와서 히든태그에 넣어준다 
            				console.log(res.data.key);
            				console.log(res.data.id);
            				 $('#aa').val(res.data.key);
                             $('#bb').val(res.data.id);
                             console.log($('#aa').val()); 
                             console.log($('#bb').val()); 
            				
            				if(res.data.key === "null"){
            					$('#alert').html('일치하는 데이터가 없습니다. <br>이름과 이메일 주소를 확인해주세요. ')
            					console.log("키값이 널입니다.")
            				}else{
            					$('#alert').html('인증번호를 발급했습니다 ')
            					console.log("키값이 널이아닙니다.")
            				}
            			})
            		}
            	}
            } //methods
        })
        
        $('#Authbtn').on('click', function(){
            console.log("나 불렀니?");
         	var uu = $('#AuthInput').val();
        	var aa = $('#aa').val(); //인증번호
        	var bb = $('#bb').val(); //id
        	console.log("확인버튼 누름+++ uu ::::"+uu);
        	console.log("확인버튼 누름"+aa);
        	console.log("확인버튼 누름"+bb);
                    
                    if($.trim(uu) != aa){
                    	$('#alert2').html('인증번호를 다시 입력해주세요 ')

    		        }else if($.trim(uu)===""){

    		        	$('#alert2').html('인증번호를 입력해주세요')

                    }else{
                    	$('#alert2').html('<br>회원님의 아이디는 [ <b>'+ bb +'</b> ] 입니다.')
    	                        
    	                    
                    }

                    
                });
        
    </script>

</body>

</html>